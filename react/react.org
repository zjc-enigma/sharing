#+Title: React introduction
#+Author: jiancheng.zhai
#+Email: jiancheng.pro@gmail.com
#+OPTIONS: toc:nil reveal_mathjax:t
#+OPTIONS: ^:nil
#+OPTIONS: toc:nil num:nil
#+STARTUP: indent
#+REVEAL_THEME: night
#+REVEAL_TRANS: linear    
#+REVEAL_ROOT: http://cdn.jsdelivr.net/reveal.js/3.0.0/


* Web
** html
** css
** javascript
** dom tree
   #+BEGIN_SRC html
   <!DOCTYPE html>
   <html lang="en">
     <head>
       <title>My title</title>
     </head>
     <body>
       <a href="">My Link</a>
       <h1>My header</h1>
     </body>
   </html>
   #+END_SRC
   [[file:dom-tree.gif]]

* react 特性
** 虚拟 dom
   - 高效 diff 算法
   - 避免直接重置 innerHTML
   - 只更新必要的 dom

** jsx
** 组件 - 生命周期
** react - native

* 开发环境
** npm
    #+BEGIN_SRC shell
    $ sudo npm install -g npm
    $ npm install react
    #+END_SRC
    #+BEGIN_SRC json
    {
      "name": "react-demo",
      "version": "1.0.0",
      "description": "practice with react",
      "main": "index.js",
      "scripts": {
        "test": "echo \"Error: no test specified\" && exit 1"
      },
      "keywords": [
        "react"
      ],
      "author": "enigma",
      "license": "MIT",
      "dependencies": {
        "react": "^15.3.0",
        "react-router": "^2.7.0",
        "react-router-redux": "^4.0.5"
        },
      "devDependencies": {
        "redux-devtools": "^3.3.1"
       }
     }
    #+END_SRC
** webpack
   [[file:webpack.jpg]]
   #+BEGIN_SRC shell
   $ webpack --watch
   Hash: 3117d6437f7c7b27e341
   Version: webpack 1.13.1
   Time: 1641ms
           Asset     Size  Chunks             Chunk Names
       bundle.js  2.37 MB       0  [emitted]  main
   bundle.js.map  2.83 MB       0  [emitted]  main
       + 800 hidden modules
   #+END_SRC

** webpack - 配置

   #+BEGIN_SRC js
   var webpack = require('webpack');
   var ExtractTextPlugin = require("extract-text-webpack-plugin");
   var path = require("path");
   module.exports = {
     entry: [
       'whatwg-fetch',
       "./app/index.js"
     ],
     devtool: 'source-map',
     output: {
       path: __dirname + '/static',
       filename: "bundle.js"
     },
     resolve: {
         extensions: ['', '.scss', '.css', '.js', '.json'],
         modulesDirectories: [
             'node_modules',
             path.resolve(__dirname, './node_modules')
         ]
     },
     module: {
       loaders: [
         {
           test: /\.js?$/,
           loader: 'babel-loader',
           query: {
             presets: ['es2015', 'react', 'stage-0'],
             plugins: ['transform-runtime', 'transform-decorators-legacy']
           },
           exclude: /node_modules/
         },
         {
             test: /(\.scss|\.css)$/,
           loaders:["style", "css", "sass"]
         }
       ]
     },
     plugins: [
         new ExtractTextPlugin('theme.css', { allChunks: true }),
     ]
   };
   #+END_SRC

** devtools
#+BEGIN_SRC js
module.exports = {
  devtool: 'source-map',
}
#+END_SRC
#+BEGIN_SRC js
const DevTools = createDevTools(
    <DockMonitor toggleVisibilityKey="ctrl-h" changePositionKey="ctrl-q">
    <LogMonitor theme="tomorrow" preserveScrollTop={false} />
    </DockMonitor>
)
const store = createStore(rootReducer, DevTools.instrument())
ReactDOM.render(
    <Provider store={store}>
    <div>
    <HorizontalLinearStepper />
    <Router history={history} routes={routes} />
    <DevTools />
    </div>
    </Provider>,
  document.getElementById('demo1'));
#+END_SRC

** babel - .babelrc
#+BEGIN_SRC js
{
  "presets": ["stage-0", ["es2015", { "loose": true }]],
  "env": {
    "test": {
      "plugins": ["istanbul"]
    }
  }
}
#+END_SRC
** ES5 vs ES6
** 语法检查

* 常用库
** redux vs flux
[[file:flux.png]]
** react-router
** thunk
** layout

* 服务端
** server side render
#+BEGIN_SRC text
renderToString
renderToStaticMarkup
#+END_SRC

#+BEGIN_SRC js
import path from 'path'
import Express from 'express'
import React from 'react'
import { createStore } from 'redux'
import { Provider } from 'react-redux'
import counterApp from './reducers'
import App from './containers/App'

const app = Express()
const port = 3000

// This is fired every time the server side receives a request
app.use(handleRender)

// We are going to fill these out in the sections to follow
function handleRender(req, res) { /* ... */ }
function renderFullPage(html, preloadedState) { /* ... */ }
app.listen(port)
#+END_SRC
** server side render

#+BEGIN_SRC js
import { renderToString } from 'react-dom/server'

function handleRender(req, res) {
  // Create a new Redux store instance
  const store = createStore(counterApp)

  // Render the component to a string
  const html = renderToString(
    <Provider store={store}>
      <App />
    </Provider>
  )

  // Grab the initial state from our Redux store
  const preloadedState = store.getState()

  // Send the rendered page back to the client
  res.send(renderFullPage(html, preloadedState))
}
#+END_SRC

** server side render
#+BEGIN_SRC js

function renderFullPage(html, preloadedState) {
  return `
    <!doctype html>
    <html>
      <head>
        <title>Redux Universal Example</title>
      </head>
      <body>
        <div id="root">${html}</div>
        <script>
          window.__PRELOADED_STATE__ = ${JSON.stringify(preloadedState)}
        </script>
        <script src="/static/bundle.js"></script>
      </body>
    </html>
    `
}
#+END_SRC
** server side render 

** restful api

* Tips
** 浏览器兼容性
** deepcopy

#+BEGIN_SRC js
let a = [1,2,3]
let b = a.slice()
#+END_SRC

** JSX 加载
#+BEGIN_SRC js
require("babel-register");
#+END_SRC

** ES6 support
#+BEGIN_SRC js
require('babel-core/register');
require('./server');
#+END_SRC



* Q & A
